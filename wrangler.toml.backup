name = "personality-spark-api"
main = "personality-spark-api/src/index-assets.ts"
compatibility_date = "2024-05-01"
compatibility_flags = ["nodejs_compat"]

# Account details
account_id = "79c03e5169d22c2c869d0d3c80932187"

# Workers AI
[ai]
binding = "AI"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "personality-spark-db"
database_id = "0e844e2c-54e1-4122-bab1-698fc86be2f6"

# KV Namespaces
[[kv_namespaces]]
binding = "SESSIONS"
id = "643c50b21e5d44aca5f49c84a509a40d"

[[kv_namespaces]]
binding = "CACHE"
id = "c79fa3abb6d949d5aa540373fbb9fe4a"

# R2 Storage
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "personality-spark-media"

[[r2_buckets]]
binding = "MEDIA"
bucket_name = "personality-spark-media"

[[r2_buckets]]
binding = "BACKUPS"
bucket_name = "personality-spark-backups"

[[r2_buckets]]
binding = "FILES"
bucket_name = "personality-spark-files"

# Durable Objects
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"
script_name = "personality-spark-api"

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiter"]

# Environment variables
[vars]
ENVIRONMENT = "production"
API_VERSION = "v1"
CORS_ORIGIN = "https://personalityspark.com"

# Assets - serve the frontend from the Worker
# Using new syntax for Wrangler 4.x
[assets]
directory = "./personality-spark-api/public"

# Observability
[observability]
enabled = true